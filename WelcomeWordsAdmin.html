<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #41444C;
      color: white;
      font-family: sans-serif;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      -webkit-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .logo {
      width: 322px;
      height: auto;
      margin-bottom: 40px;
      display: block;
      max-width: 90%;
    }

    .menu-button {
      display: block;
      width: 80%;
      max-width: 300px;
      padding: 15px 20px;
      margin-bottom: 20px;
      text-align: center;
      text-decoration: none;
      color: white;
      background-color: #555;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1em;
      transition: background-color 0.3s ease;
    }

    .menu-button:hover {
      background-color: #666;
    }

    .menu-button:focus {
      outline: none;
    }

    .menu-button:last-child {
      margin-bottom: 0;
    }

    * {
      box-sizing: border-box;
    }

    #adminLabel {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 16px;
      color: #fff;
      background: rgba(0,0,0,0.3);
      padding: 4px 10px;
      border-radius: 5px;
    }
  </style>
</head>
<body>

  <div id="adminLabel" style="display:none;">Admin mode</div>

  <img src="22-36-24-logo-1.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="logo">

  <a href="testingAdmin.html" class="menu-button">–ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É</a>
  <a href="redactionAdmin.html" class="menu-button">–†–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫</a>
  <a href="saverAdmin.html" class="menu-button" id="importExportBtn">–ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</a>

  <script>
    const admin = true; // ‚Üê –∏–∑–º–µ–Ω—è–π –Ω–∞ true –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞

    const importExportBtn = document.getElementById('importExportBtn');
    const adminLabel = document.getElementById('adminLabel');

    // ADMIN mode visual
    if (admin) {
      adminLabel.style.display = 'block';
    } else {
      // Hide button
      importExportBtn.style.display = 'none';

      // Try to load external storage dump
      fetch('https://raw.githubusercontent.com/Vaneyn/welcome/refs/heads/main/adminfilesysdataserver.txt')
        .then(res => {
          if (!res.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ');
          return res.text();
        })
        .then(b64 => {
          const decoded = decodeUTF8(b64.trim());
          const imported = JSON.parse(decoded);
          const log = [];

          for (const [key, value] of Object.entries(imported)) {
            const existing = localStorage.getItem(key);
            if (existing === null) {
              localStorage.setItem(key, value);
              log.push(`üÜï –î–æ–±–∞–≤–ª–µ–Ω –∫–ª—é—á: ${key}`);
            } else if (existing !== value) {
              localStorage.setItem(key, value);
              log.push(`üîÅ –û–±–Ω–æ–≤–ª—ë–Ω –∫–ª—é—á: ${key}`);
            } else {
              log.push(`‚úîÔ∏è –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${key}`);
            }
          }

          console.group('üì¶ –ò–º–ø–æ—Ä—Ç –∏–∑ —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞');
          log.forEach(msg => console.log(msg));
          console.groupEnd();
        })
        .catch(err => {
          console.log('‚ö†Ô∏è –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∞–≤—Ç–æ–∏–º–ø–æ—Ä—Ç: ', err.message);
        });
    }

    // --- –î–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ: ready ‚Üí terminal.html ---
    let pressTimer;
    let state = 'normal'; // 'normal' ‚Üí 'ready'

    importExportBtn.addEventListener('touchstart', (e) => {
      pressTimer = setTimeout(() => {
        if (state === 'normal') {
          adminLabel.textContent = 'ready';
          adminLabel.style.display = 'block';
          state = 'ready';
        } else if (state === 'ready') {
          window.location.href = 'terminal.html';
        }
      }, 2000);
    });

    importExportBtn.addEventListener('touchend', () => clearTimeout(pressTimer));
    importExportBtn.addEventListener('touchcancel', () => clearTimeout(pressTimer));

    // TextDecoder/Encoder
    function decodeUTF8(b64) {
      const binary = atob(b64);
      const bytes = new Uint8Array([...binary].map(ch => ch.charCodeAt(0)));
      return new TextDecoder().decode(bytes);
    }
  </script>

</body>
</html>
